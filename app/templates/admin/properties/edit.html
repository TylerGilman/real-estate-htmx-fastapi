<div id="edit-property-form" class="form-container">
    <div class="admin-header">
        <h2>Edit Property</h2>
        <button type="button" class="close-button" onclick="cancelForm()" aria-label="Close form">Ã—</button>
    </div>
    
    <form hx-put="/admin/properties/{{ property.property_id }}"
          class="property-form"
          hx-target="#property-{{ property.property_id }}"
          hx-push-url="false"
          hx-swap="outerHTML"
          >
        
        {% include "admin/properties/form_fields.html" %}

        <!-- Image Management Section -->
        <div class="form-section">
            <div class="form-header">Property Images</div>
            <div class="image-upload-container">
                <div class="current-images" id="property-images">
                    {% if property.images %}
                        {% for image in property.images %}
                        <div class="image-preview" id="image-{{ image.image_id }}">
                            <img src="/static/{{ image.file_path }}" alt="Property image">
                            <div class="image-actions">
                                <button type="button" 
                                        class="set-primary-btn {% if image.is_primary %}active{% endif %}"
                                        hx-put="/admin/properties/images/{{ image.image_id }}/primary"
                                        hx-target="#property-images">
                                    Set as Primary
                                </button>
                                <button type="button" 
                                        class="delete-btn"
                                        hx-delete="/admin/properties/images/{{ image.image_id }}"
                                        hx-confirm="Are you sure you want to delete this image?"
                                        hx-target="#image-{{ image.image_id }}">
                                    Delete
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-images-message">
                            No images uploaded yet
                        </div>
                    {% endif %}
                </div>
                
                <div class="upload-new">
                    <label class="file-upload-label">
                        <input type="file" 
                               name="property_image" 
                               accept=".jpg,.jpeg,.png,.webp"
                               hx-post="/admin/properties/{{ property.property_id }}/images"
                               hx-encoding="multipart/form-data"
                               hx-target="#property-images"
                               hx-trigger="change">
                        Add Image
                    </label>
                    <p class="help-text">Max file size: 5MB. Allowed types: JPG, PNG, WebP</p>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button type="button" onclick="cancelForm()" class="cancel-button">Cancel</button>
            <button type="submit" class="submit-button">Update Property</button>
        </div>
    </form>
</div>

<style>
.image-upload-container {
    margin-top: 1rem;
}

.current-images {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.image-preview {
    position: relative;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.image-preview img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}

.image-actions {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    padding: 0.5rem;
    display: flex;
    gap: 0.5rem;
}

.set-primary-btn,
.delete-btn {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    cursor: pointer;
}

.set-primary-btn {
    background: var(--swedish-blue);
    color: white;
    border: none;
}

.set-primary-btn.active {
    background: var(--swedish-navy);
}

.delete-btn {
    background: #ef4444;
    color: white;
    border: none;
}

.file-upload-label {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--swedish-accent);
    color: var(--swedish-navy);
    border-radius: 0.5rem;
    cursor: pointer;
}

.file-upload-label input[type="file"] {
    display: none;
}

.help-text {
    font-size: 0.875rem;
    color: var(--swedish-text);
    opacity: 0.8;
    margin-top: 0.5rem;
}

.no-images-message {
    text-align: center;
    padding: 2rem;
    background: var(--swedish-gray);
    border-radius: 0.5rem;
    color: var(--swedish-text);
    font-style: italic;
}

/* Ensure form container matches your existing styles */
.form-container {
    background: var(--swedish-white);
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    margin: 1rem 0;
    padding: 1.5rem;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.close-button {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--swedish-text);
    cursor: pointer;
    padding: 0.5rem;
}

.close-button:hover {
    color: var(--swedish-navy);
}
</style>
