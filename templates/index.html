{% extends "base.html" %}
{% block title %}Data-Driven Real Estate Agency{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<div id="content">
        <section class="hero-section">
            <div class="container">
                <h1 class="section-title">Cherokee Street: Data Driven Real Estate</h1>
                <p class="agency-intro">
                    "At Cherokee Street Real Estate, our small team of tech-savvy agents is committed to delivering exceptional results."
                </p>
            </div>
        </section>
        
        <div class="container">
            <h2 class="section-title">Featured Listings</h2>
            <button id="toggle-search" class="button">
                Close Search Controls
            </button>
<div id="search-controls-wrapper" name="search-controls-wrapper">
            <h3>Advanced Property Search Controls</h3>
    <div id="search-container container">
              <form id="search-form">
                <div class="search-controls-container">
                    <label for="search-text">Search by Name</label>
                    <input type="text" name="search-text" id="search-text" placeholder="Search properties by name..." 
                           hx-post="/search"
                           hx-trigger="keyup changed delay:100ms"
                           hx-target="#listings-container"
                           hx-indicator=".htmx-indicator"
                           hx-swap="outerHTML">
                    <div id="price-controls-container">
                        <div>
                            <label for="search-min-price">Minimum Price</label>
                            <input id="search-min-price" type="number" name="search-min-price" placeholder="0" 
                                   hx-post="/search"
                                   hx-trigger="keyup changed delay:500ms"
                                   hx-target="#listings-container"
                                   hx-indicator=".htmx-indicator"
                                   hx-swap="outerHTML">
                        </div>
                        <div>
                            <label for="search-max-price">Maximum Price</label>
                            <input id="search-max-price" type="number" name="search-max-price" placeholder="15,000,000" 
                                   hx-post="/search"
                                   hx-trigger="keyup changed delay:500ms"
                                   hx-target="#listings-container"
                                   hx-indicator=".htmx-indicator"
                                   hx-swap="outerHTML">
                        </div>
                    </div>
                    <div id="style-controls-container"> 
                        <label for="search-style">Choose Style:</label>
                        <select name="search-style" id="search-style">
                            <option value="All">All</option>
                            <option value="House">House</option>
                            <option value="Apartment">Apartment</option>
                            <option value="Brownstone">Brownstone</option>
                        </select>
                    </div>
                    <button hx-post="/randomize" hx-target="#listings-container" hx-swap="outerHTML" class="button">Shuffle All Listings</button>
                    <div class="htmx-indicator">Searching...</div>
                </div>
              </form>
            </div>
          </div>
        </div>
    <div id="listings-container" class="gridContainer">
        {% for listing in listings %}
        <div class="listing" hx-get="/property/{{ listing.id }}" hx-trigger="click" hx-target="#content" hx-push-url="true">
            <div class="listing-image">
                <img src="{{ listing.image_url }}" alt="{{ listing.title }}">
            </div>
            <div class="listing-info">
                <h2>{{ listing.title }}</h2>
                <p class="price">${{ "{:,.2f}".format(listing.price) }}</p>
                <p class="details">{{ listing.bedrooms }} bd | {{ listing.bathrooms }} ba | {{ listing.square_feet }} sqft</p>
                <p class="address">{{ listing.address }}</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <section class="agency-description">
        <div class="container">
            <div class="agency-features">
                <div class="feature">
                    <h3>Market Predictions</h3>
                    <p>Our predictive models help you make informed decisions about when to buy or sell.</p>
                </div>
            </div>
            <a href="/about" class="learn-more-button">Learn More About Our Approach</a>
        </div>
    </section>
<script preload>
// Global variable to store the toggle function
let globalToggleSearchControls;

function applyCropsAndLayout() {
    const listings = document.querySelectorAll('.listing');
    const cropTypes = ['portrait', 'landscape', 'square'];
    listings.forEach(listing => {
        const randomCrop = cropTypes[Math.floor(Math.random() * cropTypes.length)];
        listing.classList.remove('portrait', 'landscape', 'square');
        listing.classList.add(randomCrop);
    });
}

// Initial setup
document.addEventListener('DOMContentLoaded', function() {
    applyCropsAndLayout();
});

// Setup after HTMX content swap
document.body.addEventListener('htmx:afterSwap', function(event) {
    applyCropsAndLayout();
});

</script>
</div>
{% endblock %}
